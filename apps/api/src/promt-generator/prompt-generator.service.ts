import { Injectable, Logger } from '@nestjs/common';
import { PrismaService } from 'src/prisma/prisma.service';
import { ITechnicalAnalysisResult } from '../analysis/analysis.service';
import { IAnalysisIssue } from '../analysis/interfaces/analysis.interface';
import { IPerformanceAnalysisResult } from '../analysis/interfaces/performance-analysis.interface';
import { ISeoAnalysisResult } from '../analysis/interfaces/seo-analysis.interface';

/**
 * –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤
 */
export interface IGeneratedPrompt {
  id: string;
  name: string;
  description: string;
  promptText: string;
  targetUse: string;
}

// –¢–∏–ø –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã
type IssueSeverity = 'critical' | 'major' | 'moderate' | 'minor' | 'info';

interface IExtendedAnalysisIssue extends IAnalysisIssue {
  analyzerName: string;
}

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
interface ICategorizedIssues {
  critical: IExtendedAnalysisIssue[];
  major: IExtendedAnalysisIssue[];
  moderate: IExtendedAnalysisIssue[];
  minor: IExtendedAnalysisIssue[];
  info: IExtendedAnalysisIssue[];
}

@Injectable()
export class PromptGeneratorService {
  private readonly logger = new Logger(PromptGeneratorService.name);

  constructor(private readonly prisma: PrismaService) {}

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è LLM –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   * @param scanId ID —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   */
  public async generatePrompts(
    scanId: string,
    analysisResult: ITechnicalAnalysisResult,
  ): Promise<IGeneratedPrompt[]> {
    this.logger.log(`Generating prompts for scan ${scanId}`);

    const generatedPrompts: IGeneratedPrompt[] = [];

    try {
      // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
      const pageScan = await this.prisma.pageScan.findUnique({
        where: { id: scanId },
        include: {
          project: true,
          elements: {
            select: {
              id: true,
              type: true,
              html: true,
              selector: true,
              screenshot: true,
            },
          },
        },
      });

      if (!pageScan) {
        throw new Error(`Scan with ID ${scanId} not found`);
      }

      // –°–æ–±–∏—Ä–∞–µ–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –≤—Å–µ—Ö –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
      const allIssues = this.collectAndCategorizeIssues(analysisResult);

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∞–Ω–∞–ª–∏–∑–∞
      // SEO –∞–Ω–∞–ª–∏–∑
      const seoPrompt = this.generateSeoPrompt(analysisResult, allIssues);
      if (seoPrompt) generatedPrompts.push(seoPrompt);

      // –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
      const performancePrompt = this.generatePerformancePrompt(
        analysisResult,
        allIssues,
      );
      if (performancePrompt) generatedPrompts.push(performancePrompt);

      // –ê–Ω–∞–ª–∏–∑ –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
      const mobilePrompt = this.generateMobilePrompt(analysisResult, allIssues);
      if (mobilePrompt) generatedPrompts.push(mobilePrompt);

      // –ê–Ω–∞–ª–∏–∑ —Å—Å—ã–ª–æ–∫
      const linkPrompt = this.generateLinkPrompt(analysisResult, allIssues);
      if (linkPrompt) generatedPrompts.push(linkPrompt);

      // –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      const contentPrompt = this.generateContentPrompt(
        analysisResult,
        allIssues,
      );
      if (contentPrompt) generatedPrompts.push(contentPrompt);

      // –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
      const securityPrompt = this.generateSecurityPrompt(
        analysisResult,
        allIssues,
      );
      if (securityPrompt) generatedPrompts.push(securityPrompt);

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      // –ü–æ–ª—É—á–∞–µ–º —Ç–∏–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      const elementTypes = [...new Set(pageScan.elements.map((el) => el.type))];

      for (const elementType of elementTypes) {
        const elementsOfType = pageScan.elements.filter(
          (el) => el.type === elementType,
        );

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const elementPrompt = this.generateElementPrompt(
          elementType,
          elementsOfType,
          analysisResult,
        );
        if (elementPrompt) generatedPrompts.push(elementPrompt);
      }

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–±—â–∏–π –ø—Ä–æ–º–ø—Ç —Å –æ–±–∑–æ—Ä–æ–º –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
      const generalPrompt = this.generateGeneralPrompt(
        analysisResult,
        allIssues,
        pageScan,
      );
      if (generalPrompt) generatedPrompts.push(generalPrompt);

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–º–ø—Ç—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
      await this.savePromptsToDatabase(scanId, generatedPrompts);

      return generatedPrompts;
    } catch (error) {
      this.logger.error(
        `Error generating prompts: ${error.message}`,
        error.stack,
      );
      throw error;
    }
  }

  /**
   * –°–æ–±–∏—Ä–∞–µ—Ç –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –≤—Å–µ—Ö –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   */
  private collectAndCategorizeIssues(
    analysisResult: ITechnicalAnalysisResult,
  ): ICategorizedIssues {
    const categorizedIssues: ICategorizedIssues = {
      critical: [],
      major: [],
      moderate: [],
      minor: [],
      info: [],
    };

    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞–º –∏ —Å–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã
    for (const analyzerName in analysisResult.analyzers) {
      const analyzer = analysisResult.analyzers[analyzerName];

      for (const issue of analyzer.issues) {
        categorizedIssues[issue.severity].push({
          ...issue,
          analyzerName, // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        });
      }
    }

    return categorizedIssues;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   * @param categorizedIssues –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   */
  private generateSeoPrompt(
    analysisResult: ITechnicalAnalysisResult,
    categorizedIssues: ICategorizedIssues,
  ): IGeneratedPrompt | null {
    const seoAnalyzer = analysisResult.analyzers[
      'SeoAnalyzer'
    ] as ISeoAnalysisResult;

    if (!seoAnalyzer) return null;

    // –°–æ–±–∏—Ä–∞–µ–º SEO-–ø—Ä–æ–±–ª–µ–º—ã –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
    const seoIssues = this.getIssuesByPrefix(categorizedIssues, 'seo-');

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ–º–ø—Ç
    const formattedIssues = this.formatIssuesForPrompt(seoIssues);

    // –°–æ–±–∏—Ä–∞–µ–º SEO-–º–µ—Ç—Ä–∏–∫–∏
    const seoMetrics = JSON.stringify(seoAnalyzer.metrics, null, 2);

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM
    const promptText = `
# SEO-–∞–Ω–∞–ª–∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ SEO
${seoAnalyzer.score}/100

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
${formattedIssues}

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ SEO
\`\`\`json
${seoMetrics}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –≤—ã—à–µ –∞–Ω–∞–ª–∏–∑–∞, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ (title, description)
2. –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å —É—á–µ—Ç–æ–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
4. –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏—Ö URL –∏ –ø–µ—Ä–µ–ª–∏–Ω–∫–æ–≤–∫–∏
5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Schema.org —Ä–∞–∑–º–µ—Ç–∫–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –∏–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç SEO
- –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é. –ù–∞—á–Ω–∏—Ç–µ —Å –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.
–ï—Å–ª–∏ —É —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–∂–µ —Ö–æ—Ä–æ—à–∏–µ SEO-–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

\`\`\`
### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** [–í—ã—Å–æ–∫–∏–π/–°—Ä–µ–¥–Ω–∏–π/–ù–∏–∑–∫–∏–π]
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** [–ß—Ç–æ —Å–µ–π—á–∞—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ]
**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ –∫–æ–¥]
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ü–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç SEO]
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–ö–∞–∫ —ç—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ]
\`\`\`
`;

    return {
      id: '',
      name: 'SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è',
      description: '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é SEO',
      promptText,
      targetUse: 'seo',
    };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   * @param categorizedIssues –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   */
  private generatePerformancePrompt(
    analysisResult: ITechnicalAnalysisResult,
    categorizedIssues: ICategorizedIssues,
  ): IGeneratedPrompt | null {
    const performanceAnalyzer = analysisResult.analyzers[
      'PerformanceAnalyzer'
    ] as IPerformanceAnalysisResult;

    if (!performanceAnalyzer) return null;

    // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
    const perfIssues = this.getIssuesByPrefix(categorizedIssues, 'perf-');

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ–º–ø—Ç
    const formattedIssues = this.formatIssuesForPrompt(perfIssues);

    // –°–æ–±–∏—Ä–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    const perfMetrics = JSON.stringify(performanceAnalyzer.metrics, null, 2);

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM
    const promptText = `
# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
${performanceAnalyzer.score}/100

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ${performanceAnalyzer.metrics.pageLoadTime} –º—Å
- First Contentful Paint: ${performanceAnalyzer.metrics.firstContentfulPaint} –º—Å
- Time to Interactive: ${performanceAnalyzer.metrics.timeToInteractive} –º—Å
- –†–∞–∑–º–µ—Ä HTML: ${(performanceAnalyzer.metrics.htmlSize / 1024).toFixed(2)} KB
- –†–∞–∑–º–µ—Ä CSS: ${(performanceAnalyzer.metrics.cssSize / 1024).toFixed(2)} KB
- –†–∞–∑–º–µ—Ä JavaScript: ${(performanceAnalyzer.metrics.jsSize / 1024).toFixed(2)} KB
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${(performanceAnalyzer.metrics.totalImageSize / 1024 / 1024).toFixed(2)} MB
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤: ${performanceAnalyzer.metrics.requestCount}
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${performanceAnalyzer.metrics.serverResponseTime} –º—Å

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
${formattedIssues}

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
\`\`\`json
${perfMetrics}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –≤—ã—à–µ –∞–Ω–∞–ª–∏–∑–∞, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ (JavaScript, CSS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
2. –£–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (FCP)
3. –£–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (TTI)
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–∂–∞—Ç–∏—è
5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
6. –£–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏
- –ü—Ä–∏–º–µ—Ä–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (–ù–∏–∑–∫–∞—è/–°—Ä–µ–¥–Ω—è—è/–í—ã—Å–æ–∫–∞—è)

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
–ù–∞—á–Ω–∏—Ç–µ —Å –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

\`\`\`
### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** [–í—ã—Å–æ–∫–∏–π/–°—Ä–µ–¥–Ω–∏–π/–ù–∏–∑–∫–∏–π]
**–ü—Ä–æ–±–ª–µ–º–∞:** [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã]
**–†–µ—à–µ–Ω–∏–µ:** [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏]
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ü–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å]
**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** [–ö–∞–∫ –∏–∑–º–µ–Ω—è—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏]
**–°–ª–æ–∂–Ω–æ—Å—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:** [–ù–∏–∑–∫–∞—è/–°—Ä–µ–¥–Ω—è—è/–í—ã—Å–æ–∫–∞—è]
\`\`\`

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞, –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–µ–±-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
`;

    return {
      id: '',
      name: '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
      description:
        '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
      promptText,
      targetUse: 'performance',
    };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   * @param categorizedIssues –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   */
  private generateMobilePrompt(
    analysisResult: ITechnicalAnalysisResult,
    categorizedIssues: ICategorizedIssues,
  ): IGeneratedPrompt | null {
    const mobileAnalyzer = analysisResult.analyzers['MobileAnalyzer'];

    if (!mobileAnalyzer) return null;

    // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
    const mobileIssues = this.getIssuesByPrefix(categorizedIssues, 'mobile-');

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ–º–ø—Ç
    const formattedIssues = this.formatIssuesForPrompt(mobileIssues);

    // –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    const mobileMetrics = JSON.stringify(mobileAnalyzer.metrics, null, 2);

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM
    const promptText = `
# –ê–Ω–∞–ª–∏–∑ –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
${mobileAnalyzer.score}/100

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
${formattedIssues}

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
\`\`\`json
${mobileMetrics}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –≤—ã—à–µ –∞–Ω–∞–ª–∏–∑–∞, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:

1. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ —Ç–∞–ø–∞–±–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
3. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ viewport
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
6. –£–ª—É—á—à–µ–Ω–∏–µ —É–¥–æ–±—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π HTML, CSS –∏–ª–∏ JavaScript –∫–æ–¥ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç –º–æ–±–∏–ª—å–Ω—ã–π –æ–ø—ã—Ç
- –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –æ–ø—ã—Ç–∞.
–ù–∞—á–Ω–∏—Ç–µ —Å –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

\`\`\`
### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** [–í—ã—Å–æ–∫–∏–π/–°—Ä–µ–¥–Ω–∏–π/–ù–∏–∑–∫–∏–π]
**–ü—Ä–æ–±–ª–µ–º–∞:** [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã]
**–†–µ—à–µ–Ω–∏–µ:** [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π HTML/CSS/JS –∫–æ–¥]
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ü–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç –º–æ–±–∏–ª—å–Ω—ã–π –æ–ø—ã—Ç]
**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** [–ö–∞–∫ –∏–∑–º–µ–Ω—è—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏]
\`\`\`
`;

    return {
      id: '',
      name: '–ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è',
      description:
        '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏',
      promptText,
      targetUse: 'mobile',
    };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Å—ã–ª–æ–∫
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   * @param categorizedIssues –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   */
  private generateLinkPrompt(
    analysisResult: ITechnicalAnalysisResult,
    categorizedIssues: ICategorizedIssues,
  ): IGeneratedPrompt | null {
    const linkAnalyzer = analysisResult.analyzers['LinkAnalyzer'];

    if (!linkAnalyzer) return null;

    // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã —Å—Å—ã–ª–æ–∫ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
    const linkIssues = this.getIssuesByPrefix(categorizedIssues, 'link-');

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ–º–ø—Ç
    const formattedIssues = this.formatIssuesForPrompt(linkIssues);

    // –ú–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ —Å—Å—ã–ª–æ–∫
    const linkMetrics = JSON.stringify(linkAnalyzer.metrics, null, 2);

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM
    const promptText = `
# –ê–Ω–∞–ª–∏–∑ —Å—Å—ã–ª–æ–∫ –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Å—ã–ª–æ–∫
${linkAnalyzer.score}/100

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Å—ã–ª–∫–∏: ${linkAnalyzer.metrics.internalLinksCount || 'N/A'}
- –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏: ${linkAnalyzer.metrics.externalLinksCount || 'N/A'}
- –ë–∏—Ç—ã–µ —Å—Å—ã–ª–∫–∏: ${linkAnalyzer.metrics.brokenLinksCount || 'N/A'}

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
${formattedIssues}

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ —Å—Å—ã–ª–æ–∫
\`\`\`json
${linkMetrics}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –≤—ã—à–µ –∞–Ω–∞–ª–∏–∑–∞, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:

1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏—Ç—ã—Ö —Å—Å—ã–ª–æ–∫
2. –£–ª—É—á—à–µ–Ω–∏–µ –∞–Ω–∫–æ—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Å—ã–ª–æ–∫
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫ (–∞—Ç—Ä–∏–±—É—Ç—ã rel, target)
4. –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø–µ—Ä–µ–ª–∏–Ω–∫–æ–≤–∫–∏
5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å—Å—ã–ª–æ–∫ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–∞–π—Ç–∞

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π HTML-–∫–æ–¥ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Å—ã–ª–æ–∫
- –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ SEO –∏ —É–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é.
–ù–∞—á–Ω–∏—Ç–µ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º (–±–∏—Ç—ã–µ —Å—Å—ã–ª–∫–∏).

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

\`\`\`
### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** [–í—ã—Å–æ–∫–∏–π/–°—Ä–µ–¥–Ω–∏–π/–ù–∏–∑–∫–∏–π]
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** [–ß—Ç–æ —Å–µ–π—á–∞—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ]
**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:** [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π HTML-–∫–æ–¥]
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ü–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Å—ã–ª–æ–∫]
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–ö–∞–∫ —ç—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ SEO –∏ UX]
\`\`\`
`;

    return {
      id: '',
      name: '–ê–Ω–∞–ª–∏–∑ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫',
      description:
        '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Å—ã–ª–æ–∫',
      promptText,
      targetUse: 'link',
    };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   * @param categorizedIssues –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   */
  private generateContentPrompt(
    analysisResult: ITechnicalAnalysisResult,
    categorizedIssues: ICategorizedIssues,
  ): IGeneratedPrompt | null {
    const contentAnalyzer = analysisResult.analyzers['ContentAnalyzer'];

    if (!contentAnalyzer) return null;

    // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
    const contentIssues = this.getIssuesByPrefix(categorizedIssues, 'content-');

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ–º–ø—Ç
    const formattedIssues = this.formatIssuesForPrompt(contentIssues);

    // –ú–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    const contentMetrics = JSON.stringify(contentAnalyzer.metrics, null, 2);

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM
    const promptText = `
# –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
${contentAnalyzer.score}/100

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –î–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${contentAnalyzer.metrics.contentLength || 'N/A'} —Å–∏–º–≤–æ–ª–æ–≤
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${contentAnalyzer.metrics.contentUniqueness || 'N/A'}%
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: ${contentAnalyzer.metrics.keywordCount || 'N/A'}
- –ß–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞: ${contentAnalyzer.metrics.readabilityScore || 'N/A'}/100
- –ö–∞—á–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${contentAnalyzer.metrics.formattingQuality || 'N/A'}/100
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫ –º–µ–¥–∏–∞: ${contentAnalyzer.metrics.textToMediaRatio || 'N/A'}

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
${formattedIssues}

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
\`\`\`json
${contentMetrics}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –≤—ã—à–µ –∞–Ω–∞–ª–∏–∑–∞, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

1. –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏ –∏—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
3. –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
5. –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–±–µ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–∑—ã–≤–æ–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ HTML-–∫–æ–¥–∞ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

\`\`\`
### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** [–í—ã—Å–æ–∫–∏–π/–°—Ä–µ–¥–Ω–∏–π/–ù–∏–∑–∫–∏–π]
**–¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç:** [–ß—Ç–æ —Å–µ–π—á–∞—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ]
**–£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:** [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ HTML-–∫–æ–¥]
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ü–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞]
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–ö–∞–∫ —ç—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å]
\`\`\`
`;

    return {
      id: '',
      name: '–ê–Ω–∞–ª–∏–∑ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞',
      description: '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞',
      promptText,
      targetUse: 'content',
    };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   * @param categorizedIssues –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   */
  private generateSecurityPrompt(
    analysisResult: ITechnicalAnalysisResult,
    categorizedIssues: ICategorizedIssues,
  ): IGeneratedPrompt | null {
    const securityAnalyzer = analysisResult.analyzers['SecurityAnalyzer'];

    if (!securityAnalyzer) return null;

    // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
    const securityIssues = this.getIssuesByPrefix(
      categorizedIssues,
      'security-',
    );

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ–º–ø—Ç
    const formattedIssues = this.formatIssuesForPrompt(securityIssues);

    // –ú–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    const securityMetrics = JSON.stringify(securityAnalyzer.metrics, null, 2);

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM
    const promptText = `
# –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
${securityAnalyzer.score}/100

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- HTTPS: ${securityAnalyzer.metrics.usesHttps ? '–î–∞' : '–ù–µ—Ç'}
- –°–º–µ—à–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç: ${securityAnalyzer.metrics.hasMixedContent ? '–î–∞' : '–ù–µ—Ç'}
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: ${securityAnalyzer.metrics.securityHeaders ? '–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã' : '–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é'}

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
${formattedIssues}

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
\`\`\`json
${securityMetrics}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –≤—ã—à–µ –∞–Ω–∞–ª–∏–∑–∞, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å HTTPS
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (HTTP –≤ HTTPS)
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Content-Security-Policy, X-XSS-Protection –∏ —Ç.–¥.)
4. –£–ª—É—á—à–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ SSL/TLS
5. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π OWASP
6. –î—Ä—É–≥–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –æ–±—â—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∞–π—Ç–∞
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π/–í—ã—Å–æ–∫–∏–π/–°—Ä–µ–¥–Ω–∏–π/–ù–∏–∑–∫–∏–π)

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.
–ù–∞—á–Ω–∏—Ç–µ —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–º.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

\`\`\`
### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π/–í—ã—Å–æ–∫–∏–π/–°—Ä–µ–¥–Ω–∏–π/–ù–∏–∑–∫–∏–π]
**–ü—Ä–æ–±–ª–µ–º–∞:** [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã]
**–†–µ—à–µ–Ω–∏–µ:** [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏]
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ü–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å]
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–ö–∞–∫ —ç—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—â—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å]
\`\`\`
`;

    return {
      id: '',
      name: '–ê–Ω–∞–ª–∏–∑ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
      description:
        '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
      promptText,
      targetUse: 'security',
    };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   * @param elementType –¢–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞
   * @param elements –°–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   */
  private generateElementPrompt(
    elementType: string,
    elements: any[],
    analysisResult: ITechnicalAnalysisResult,
  ): IGeneratedPrompt | null {
    if (!elements || elements.length === 0) return null;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
    let promptTemplate = '';
    let targetUse = '';
    let name = '';
    let description = '';

    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–Ω–µ –±–æ–ª–µ–µ 5)
    const elementExamples = elements.slice(0, 5).map((el) => ({
      html: el.html,
      selector: el.selector,
      screenshot: el.screenshot,
    }));

    const elementExamplesStr = JSON.stringify(elementExamples, null, 2);

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —à–∞–±–ª–æ–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
    if (elementType.startsWith('heading')) {
      name = '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤';
      description = '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤';
      targetUse = 'headings';

      promptTemplate = `
# –ê–Ω–∞–ª–∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
\`\`\`json
${elementExamplesStr}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤—ã—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è SEO (–≤–∫–ª—é—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤)
2. –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è H1-H6)
3. –ü–æ–≤—ã—à–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
4. –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç–∏
5. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ–ª–µ–µ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è:
- –£–∫–∞–∂–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
- –û–±—ä—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ª—É—á—à–µ

–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –∏ SEO.

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:

\`\`\`
### –ó–∞–≥–æ–ª–æ–≤–æ–∫ [–Ω–æ–º–µ—Ä]
**–û—Ä–∏–≥–∏–Ω–∞–ª:** [–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫]
**–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:** [—É–ª—É—á—à–µ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫]
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ]
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–∫–∞–∫–æ–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ SEO –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏—é]
\`\`\`
`;
    } else if (elementType.includes('cta') || elementType.includes('button')) {
      name = '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CTA-–∫–Ω–æ–ø–æ–∫';
      description =
        '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–∏–∑—ã–≤–æ–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é';
      targetUse = 'cta-buttons';

      promptTemplate = `
# –ê–Ω–∞–ª–∏–∑ CTA-–∫–Ω–æ–ø–æ–∫ –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –ü—Ä–∏–º–µ—Ä—ã CTA-–∫–Ω–æ–ø–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
\`\`\`json
${elementExamplesStr}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤—ã—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ CTA-–∫–Ω–æ–ø–æ–∫, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏:

1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ–ª–µ–µ —É–±–µ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∫–Ω–æ–ø–æ–∫
2. –£–ª—É—á—à–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞ –∏ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –∫–Ω–æ–ø–æ–∫ (—Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ)
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
5. –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ –∏ –∑–∞–º–µ—Ç–Ω–æ—Å—Ç–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è:
- –ü–æ–∫–∞–∂–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É (HTML)
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é (HTML –∏ CSS)
- –û–±—ä—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ª—É—á—à–µ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:

\`\`\`
### CTA-–∫–Ω–æ–ø–∫–∞ [–Ω–æ–º–µ—Ä]
**–û—Ä–∏–≥–∏–Ω–∞–ª:** [–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π HTML-–∫–æ–¥]
**–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:** 
\`\`\`html
[—É–ª—É—á—à–µ–Ω–Ω—ã–π HTML –∏ CSS –∫–æ–¥]
\`\`\`
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—é]
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–∫–∞–∫–æ–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é]
\`\`\`

–û–±—Ä–∞—Ç–∏—Ç–µ –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ—Ç–∏–≤–∏—Ä—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –¥–µ–π—Å—Ç–≤–∏—é.
`;
    } else if (elementType.includes('form')) {
      name = '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º';
      description = '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Ñ–æ—Ä–º';
      targetUse = 'forms';

      promptTemplate = `
# –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –ü—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ä–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
\`\`\`json
${elementExamplesStr}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤—ã—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ñ–æ—Ä–º, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏:

1. –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ñ–æ—Ä–º –∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª–µ–π
2. –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–µ–π –∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
4. –£–ª—É—á—à–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞ –∏ —é–∑–∞–±–∏–ª–∏—Ç–∏
5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–æ–≤–µ—Ä–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è:
- –ü–æ–∫–∞–∂–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ–æ—Ä–º—É (HTML)
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é (HTML –∏ CSS)
- –û–±—ä—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ª—É—á—à–µ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:

\`\`\`
### –§–æ—Ä–º–∞ [–Ω–æ–º–µ—Ä]
**–û—Ä–∏–≥–∏–Ω–∞–ª:** [–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π HTML-–∫–æ–¥]
**–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:** 
\`\`\`html
[—É–ª—É—á—à–µ–Ω–Ω—ã–π HTML –∏ CSS –∫–æ–¥]
\`\`\`
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—é]
**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. [–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1]
2. [–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2]
...
\`\`\`

–û–±—Ä–∞—Ç–∏—Ç–µ –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º.
`;
    } else if (
      elementType.includes('navigation') ||
      elementType.includes('menu')
    ) {
      name = '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏';
      description = '–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏';
      targetUse = 'navigation';

      promptTemplate = `
# –ê–Ω–∞–ª–∏–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –ü—Ä–∏–º–µ—Ä—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
\`\`\`json
${elementExamplesStr}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤—ã—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏:

1. –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø–æ—Ä—è–¥–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∏–∫—Ä–æ–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π (—Ö–æ–≤–µ—Ä-—ç—Ñ—Ñ–µ–∫—Ç—ã –∏ —Ç.–¥.)
4. –£–ª—É—á—à–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è SEO
6. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è:
- –ü–æ–∫–∞–∂–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é (HTML –∏ CSS)
- –û–±—ä—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ª—É—á—à–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:

\`\`\`
### –ù–∞–≤–∏–≥–∞—Ü–∏—è [–Ω–æ–º–µ—Ä]
**–û—Ä–∏–≥–∏–Ω–∞–ª:** [–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π HTML-–∫–æ–¥]
**–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:** 
\`\`\`html
[—É–ª—É—á—à–µ–Ω–Ω—ã–π HTML –∏ CSS –∫–æ–¥]
\`\`\`
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ —É–ª—É—á—à–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç]
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–∫–∞–∫–æ–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –∏ —é–∑–∞–±–∏–ª–∏—Ç–∏]
\`\`\`
`;
    } else {
      // –û–±—â–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      name = `–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ ${elementType}`;
      description = `–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ ${elementType}`;
      targetUse = elementType.replace(/[^a-z0-9]/gi, '-').toLowerCase();

      promptTemplate = `
# –ê–Ω–∞–ª–∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ "${elementType}" –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –ü—Ä–∏–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤
\`\`\`json
${elementExamplesStr}
\`\`\`

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤—ã—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ "${elementType}", –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞:

1. –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ —Ç–µ–∫—Å—Ç–∞
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω–∞ –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
3. –£–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è SEO (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
5. –ü–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (accessibility)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è:
- –ü–æ–∫–∞–∂–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é (HTML –∏ CSS)
- –û–±—ä—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ª—É—á—à–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:

\`\`\`
### –≠–ª–µ–º–µ–Ω—Ç [–Ω–æ–º–µ—Ä]
**–û—Ä–∏–≥–∏–Ω–∞–ª:** [–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π HTML-–∫–æ–¥]
**–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:** 
\`\`\`html
[—É–ª—É—á—à–µ–Ω–Ω—ã–π HTML –∏ CSS –∫–æ–¥]
\`\`\`
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** [–ø–æ—á–µ–º—É —ç—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ –±—É–¥–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ]
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–∫–∞–∫–æ–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é, —é–∑–∞–±–∏–ª–∏—Ç–∏ –∏–ª–∏ SEO]
\`\`\`
`;
    }

    return {
      id: '',
      name,
      description,
      promptText: promptTemplate,
      targetUse,
    };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–±—â–∏–π –ø—Ä–æ–º–ø—Ç —Å –æ–±–∑–æ—Ä–æ–º –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
   * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
   * @param categorizedIssues –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   * @param pageScan –î–∞–Ω–Ω—ã–µ –æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   */
  private generateGeneralPrompt(
    analysisResult: ITechnicalAnalysisResult,
    categorizedIssues: ICategorizedIssues,
    pageScan: any,
  ): IGeneratedPrompt {
    // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    const criticalCount = categorizedIssues.critical.length;
    const majorCount = categorizedIssues.major.length;
    const moderateCount = categorizedIssues.moderate.length;
    const minorCount = categorizedIssues.minor.length;
    const infoCount = categorizedIssues.info.length;

    // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º
    const totalCount =
      criticalCount + majorCount + moderateCount + minorCount + infoCount;

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–æ–ø-5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏ –≤–∞–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
    const topIssues = [
      ...categorizedIssues.critical,
      ...categorizedIssues.major,
    ]
      .slice(0, 5)
      .map(
        (issue, index) =>
          `${index + 1}. **${issue.message}** (${issue.severity}, ${issue.analyzerName})`,
      )
      .join('\n');

    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—â–∏–π –ø—Ä–æ–º–ø—Ç
    const promptText = `
# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

## URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã
${analysisResult.url}

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
${analysisResult.overallScore}/100

## –°–≤–æ–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã: ${criticalCount}
- –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã: ${majorCount}
- –£–º–µ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã: ${moderateCount}
- –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã: ${minorCount}
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è: ${infoCount}
- –í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º: ${totalCount}

## –¢–æ–ø –ø—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è
${topIssues || '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ'}

## –ó–∞–¥–∞—á–∞ –¥–ª—è LLM
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, —Å–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã. 
–í–∞—à–∞ –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü—É —Å–∞–π—Ç–∞ 
–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –∏ SEO.

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:

1. –ö—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∞–π—Ç–∞ (—Å–∏–ª—å–Ω—ã—Ö –∏ —Å–ª–∞–±—ã—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö)
2. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π —Å —á–µ—Ç–∫–∏–º–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä–∞–º–∫–∞–º–∏:
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—Ä–µ—à–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º)
   - –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)
   - –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –º–µ—Å—è—Ü–∞)
   - –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (3+ –º–µ—Å—è—Ü–µ–≤)
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è —É–∫–∞–∂–∏—Ç–µ:
   - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ
   - –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç (–≤—ã—Å–æ–∫–∏–π/—Å—Ä–µ–¥–Ω–∏–π/–Ω–∏–∑–∫–∏–π)
   - –ü—Ä–∏–º–µ—Ä–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (–≤—ã—Å–æ–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–Ω–∏–∑–∫–∞—è)
4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—Ü–µ–Ω–∫–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–Ω–µ–¥—Ä–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

–°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏–º–µ—Ç—å –Ω–∞–∏–±–æ–ª—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é, 
–æ—Ä–≥–∞–Ω–∏–∑—É—è –∏—Ö –ø–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–ª–∏—è–Ω–∏—é –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

\`\`\`
## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∞–π—Ç–∞
[–ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏]

## –ü—Ä–∏–æ—Ä–∏—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è)
1. **[–ù–∞–∑–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏—è]**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** [–û–ø–∏—Å–∞–Ω–∏–µ]
   - **–†–µ—à–µ–Ω–∏–µ:** [–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ]
   - **–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** [–í—ã—Å–æ–∫–∏–π/–°—Ä–µ–¥–Ω–∏–π/–ù–∏–∑–∫–∏–π]
   - **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** [–í—ã—Å–æ–∫–∞—è/–°—Ä–µ–¥–Ω—è—è/–ù–∏–∑–∫–∞—è]

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)
...

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –º–µ—Å—è—Ü–∞)
...

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (3+ –º–µ—Å—è—Ü–µ–≤)
...

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—Ü–µ–Ω–∫–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
[–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –∏ —Å–ø–æ—Å–æ–±–∞–º –æ—Ü–µ–Ω–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
\`\`\`
`;

    return {
      id: '',
      name: '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π',
      description: '–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã',
      promptText,
      targetUse: 'general',
    };
  }

  /**
   * –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É –∫–æ–¥–∞
   * @param categorizedIssues –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   * @param prefix –ü—Ä–µ—Ñ–∏–∫—Å –∫–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º—ã
   */
  private getIssuesByPrefix(
    categorizedIssues: ICategorizedIssues,
    prefix: string,
  ): { severity: IssueSeverity; issues: IAnalysisIssue[] }[] {
    const result: { severity: IssueSeverity; issues: IAnalysisIssue[] }[] = [];

    const severities: IssueSeverity[] = [
      'critical',
      'major',
      'moderate',
      'minor',
      'info',
    ];

    for (const severity of severities) {
      const issues = categorizedIssues[severity].filter((issue) =>
        issue.code.startsWith(prefix),
      );

      if (issues.length > 0) {
        result.push({ severity, issues });
      }
    }

    return result;
  }

  /**
   * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ–º–ø—Ç
   * @param issuesBySeverity –ü—Ä–æ–±–ª–µ–º—ã, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏
   */
  private formatIssuesForPrompt(
    issuesBySeverity: { severity: IssueSeverity; issues: IAnalysisIssue[] }[],
  ): string {
    if (issuesBySeverity.length === 0) {
      return '–ó–Ω–∞—á–∏–º—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.';
    }

    const severityEmoji = {
      critical: 'üî¥',
      major: 'üü†',
      moderate: 'üü°',
      minor: 'üîµ',
      info: '‚ÑπÔ∏è',
    } as const;

    const formattedSections = issuesBySeverity.map(({ severity, issues }) => {
      const issuesList = issues
        .map((issue) => {
          const recommendations = issue.recommendations
            ? `\n   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: ${issue.recommendations.join(', ')}`
            : '';

          return `${severityEmoji[severity]} ${issue.message}${recommendations}`;
        })
        .join('\n');

      return `### ${severity.charAt(0).toUpperCase() + severity.slice(1)} (${issues.length})\n${issuesList}`;
    });

    return formattedSections.join('\n\n');
  }

  /**
   * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   * @param scanId ID —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   * @param prompts –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   */
  private async savePromptsToDatabase(
    scanId: string,
    prompts: IGeneratedPrompt[],
  ): Promise<void> {
    try {
      await this.prisma.$transaction(
        prompts.map((prompt) =>
          this.prisma.prompt.create({
            data: {
              name: prompt.name,
              description: prompt.description,
              promptText: prompt.promptText,
              targetUse: prompt.targetUse,
              pageScanId: scanId,
            },
          }),
        ),
      );

      this.logger.log(`Saved ${prompts.length} prompts for scan ${scanId}`);
    } catch (error) {
      this.logger.error(
        `Error saving prompts to database: ${error.message}`,
        error.stack,
      );
      throw error;
    }
  }

  /**
   * –ü–æ–ª—É—á–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   * @param scanId ID —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   */
  public async getPromptsByScanId(scanId: string): Promise<IGeneratedPrompt[]> {
    try {
      const prompts = await this.prisma.prompt.findMany({
        where: { pageScanId: scanId },
      });

      return prompts.map((prompt) => ({
        id: prompt.id,
        name: prompt.name,
        description: prompt.description || '',
        promptText: prompt.promptText,
        targetUse: prompt.targetUse,
      }));
    } catch (error) {
      this.logger.error(`Error getting prompts: ${error.message}`, error.stack);
      throw error;
    }
  }
}
